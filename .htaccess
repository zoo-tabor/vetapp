# =============================================
# VetApp Mobile - Apache Configuration
# VEDOS Hosting Compatible
# =============================================

# Enable rewrite engine
RewriteEngine On

# HTTPS Enforcement (recommended by VEDOS)
RewriteCond %{HTTPS} off
RewriteRule (.*) https://%{HTTP_HOST}/$1 [R=301,L]

# Security Headers
<IfModule mod_headers.c>
    # Upgrade insecure requests to HTTPS
    Header set Content-Security-Policy "upgrade-insecure-requests;"

    # Prevent clickjacking
    Header set X-Frame-Options "SAMEORIGIN"

    # XSS Protection
    Header set X-XSS-Protection "1; mode=block"

    # Prevent MIME sniffing
    Header set X-Content-Type-Options "nosniff"

    # Referrer Policy
    Header set Referrer-Policy "strict-origin-when-cross-origin"
</IfModule>

# Block access to sensitive files and directories
<FilesMatch "\.(env|json|htaccess|htpasswd|ini|log|sh|inc|bak|sql|md|txt)$">
    Require all denied
</FilesMatch>

# Block access to config and system files
<FilesMatch "^(config\.php|\.git.*|composer\.(json|lock))$">
    Require all denied
</FilesMatch>

# Block directory listing
Options -Indexes

# Protect app directory from direct access
RewriteRule ^app/ - [F,L]
RewriteRule ^database/ - [F,L]
RewriteRule ^vendor/ - [F,L]

# Allow access to public assets
<FilesMatch "\.(css|js|jpg|jpeg|png|gif|ico|svg|woff|woff2|ttf|eot|webp|pdf)$">
    Require all granted

    # Cache control for static assets
    <IfModule mod_headers.c>
        Header set Cache-Control "public, max-age=31536000, immutable"
    </IfModule>
</FilesMatch>

# Main routing - redirect all requests to public/index.php
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ public/index.php [QSA,L]

# NOTE: php_flag and php_value are blocked by VEDOS
# Use php.ini or ini_set() in PHP code instead

# Error documents (optional)
# ErrorDocument 404 /public/index.php
# ErrorDocument 500 /public/index.php